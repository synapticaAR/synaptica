<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Synaptica</title>

  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    .ocultar-hero {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s ease;
      height: 0;
      overflow: hidden;
    }
  </style>
</head>

<body class="index">
  <section class="hero" id="top">
    <img src="Ayuda.png" alt="Logo" class="logo">
    <h1>Synaptica</h1>
    <p>La inteligencia que entiende emociones</p>
    <button class="cta" onclick="scrollToMain()">Empezar</button>
  </section>

  <nav id="mainNav">
    <a href="index.html">Inicio</a>
    <a href="ayuda.html">Ayuda</a>
    <a href="chat.html">IA Especializada</a>
    <a href="relajacion.html">Relajación</a>
    <a href="psicologo.html">Psicólogo</a>
  </nav>

  <header id="mainHeader">
    <h2>SYNAPTICA</h2>
    <p>Tu espacio inteligente de apoyo emocional y psicológico</p>
  </header>

  <section id="main">
    <div class="chat-card">
      <div id="introChatBox" class="chat-box" aria-live="polite"></div>
      <div class="chat-input">
        <input id="introUserInput" type="text" placeholder="Escribí cómo te sentís…">
        <button onclick="introSend()">Enviar</button>
        <button id="vozToggle" onclick="toggleVoz()">🔊 Voz ON</button>
      </div>
    </div>
  </section>

  <footer>
    Synaptica © 2025 – Salud mental sin barreras
  </footer>

<script>
function scrollToMain(){
  const hero   = document.querySelector('.hero');
  const nav    = document.getElementById('mainNav');
  const header = document.getElementById('mainHeader');

  hero.classList.add('ocultar-hero');

  setTimeout(()=>{
    document.body.classList.remove('index');
    document.body.classList.add('mostrar-header');
    hero.remove();
    nav.classList.add('show');
    document.getElementById('main').scrollIntoView({ behavior: 'smooth' });
  }, 800);
}

const introChat = document.getElementById('introChatBox');
let vozActiva = true;

function introPush(role, txt){
  const msg = document.createElement('div');
  msg.className = 'message fade ' + (role === 'user' ? 'user' : 'ia');
  msg.textContent = txt;
  introChat.appendChild(msg);
  introChat.scrollTop = introChat.scrollHeight;
  if(role === 'ia' && vozActiva) hablar(txt);
}

introPush('ia','¿Cómo te sentís hoy? Contanos.');
hablar('¿Cómo te sentís hoy? Contanos.');

const routes=[
  { re:/psicolog/i,                     href:'psicologo.html' },
  { re:/relaja|medit|ansiedad|respira/i,href:'relajacion.html'},
  { re:/ia|chat|conversa/i,             href:'chat.html'     },
  { re:/ayuda|urgencia|hablar|contencion/i,href:'ayuda.html' }
];

function introSend(){
  const box   = document.getElementById('introUserInput');
  const texto = box.value.trim();
  if(!texto) return;

  introPush('user', texto);
  box.value = '';

  for(const r of routes){
    if(r.re.test(texto)){
      introPush('ia','¡Entendido! Te acompañamos allí…');
      hablar('¡Entendido! Te acompañamos allí…');
      setTimeout(()=>location.href=r.href,1200);
      return;
    }
  }

  fetch("https://eae9efbf-3f34-41bb-b03b-4ad9dbeedd61-00-23tds4nuay46d.picard.replit.dev/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages: [ { role: "user", content: texto } ] })
  })
  .then(res => res.json())
  .then(data => {
    let respuesta = data.reply || "Sin respuesta del servidor.";

    if (/^.*(sou|estou|psicólogo|psicologa).*/i.test(respuesta) && /portugu/i.test(respuesta)) {
      respuesta = "¿Querés hablar con un psicólogo? Podemos ayudarte.";
    }

    if (/mal|ansiedad|triste|angustia|solo/i.test(texto)) {
      respuesta += "\nNo estás solo. Si necesitás hablar con un profesional, puedo llevarte ahora.";
    }

    introPush('ia', respuesta);
  })
  .catch(err => {
    console.error(err);
    introPush('ia', "Lo siento, hubo un error al conectarse con la IA.");
  });
}

window.addEventListener('DOMContentLoaded',()=>{
  const input  = document.getElementById('introUserInput');
  const micBtn = document.createElement('button');
  micBtn.textContent='🎤';
  micBtn.style.cssText='padding:0 12px;font-size:18px;border:none;background:transparent;cursor:pointer';
  input.parentNode.insertBefore(micBtn,input.nextSibling);

  if('webkitSpeechRecognition' in window){
    const recognition=new webkitSpeechRecognition();
    recognition.lang='es-AR';
    recognition.continuous=false;
    recognition.interimResults=false;

    micBtn.onclick=()=>{
      recognition.start();
      micBtn.textContent='🎙️';
    };
    recognition.onresult=e=>{
      input.value=e.results[0][0].transcript;
      micBtn.textContent='🎤';
    };
    recognition.onerror=()=>{ micBtn.textContent='🎤'; };
  }else micBtn.style.display='none';
});

function hablar(texto){
  if (!vozActiva) return;
  const voz=new SpeechSynthesisUtterance(texto);
  voz.lang='es-AR';
  speechSynthesis.speak(voz);
}

function toggleVoz(){
  vozActiva = !vozActiva;
  const btn = document.getElementById('vozToggle');
  btn.textContent = vozActiva ? '🔊 Voz ON' : '🔇 Voz OFF';
  if (!vozActiva) speechSynthesis.cancel();
}

document.body.classList.add('mostrar-header');
</script>
</body>
</html>
