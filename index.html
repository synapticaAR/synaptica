<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Synaptica</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="index">

  <section class="hero" id="top">
    <img src="Ayuda.png" alt="Logo" class="logo">
    <h1>Synaptica</h1>
    <p>La inteligencia que entiende emociones</p>
    <button class="cta" onclick="scrollToMain()">Empezar</button>
  </section>

  <nav id="mainNav">
    <a href="index.html">Inicio</a>
    <a href="ayuda.html">Ayuda</a>
    <a href="chat.html">IA Especializada</a>
    <a href="relajacion.html">Relajación</a>
    <a href="psicologo.html">Psicólogo</a>
  </nav>

  <header id="mainHeader">
    <h2>SYNAPTICA</h2>
    <p>Tu espacio inteligente de apoyo emocional y psicológico</p>
  </header>

  <section id="main">
    <div class="chat-card">
      <div id="introChatBox" class="chat-box"></div>

      <div class="chat-input">
        <input id="introUserInput" type="text" placeholder="Escribí cómo te sentís…">
        <button onclick="introSend()">Enviar</button>
        <button id="vozToggle" onclick="toggleVoz()">🔊 Voz ON</button>
        <button id="mic-btn">🎤</button>
      </div>
    </div>
  </section>

  <footer>
    Synaptica © 2025 – Salud mental sin barreras
  </footer>

<script>
function scrollToMain(){
  const hero = document.querySelector('.hero');
  const nav = document.getElementById('mainNav');
  const header = document.getElementById('mainHeader');

  hero.classList.add('ocultar-hero');
  setTimeout(()=>{
    document.body.classList.remove('index');
    document.body.classList.add('mostrar-header');
    hero.remove();
    nav.classList.add('show');
    document.getElementById('main').scrollIntoView({ behavior: 'smooth' });
  }, 800);
}

const introChat = document.getElementById('introChatBox');
const input = document.getElementById('introUserInput');
let vozActiva = true;

introPush('ia','¿Cómo te sentís hoy? Contanos.');
hablar('¿Cómo te sentís hoy? Contanos.');

function introPush(role, texto){
  const msg = document.createElement('div');
  msg.className = 'message ' + (role === 'user' ? 'user' : 'ia');
  msg.textContent = texto;
  introChat.appendChild(msg);
  introChat.scrollTop = introChat.scrollHeight;
  if(role === 'ia' && vozActiva) hablar(texto);
}

function introSend(){
  const texto = input.value.trim();
  if (!texto) return;

  introPush('user', texto);
  input.value = '';

  if (detectarRedireccion(texto)) return;

  fetch("https://eae9efbf-3f34-41bb-b03b-4ad9dbeedd61-00-23tds4nuay46d.picard.replit.dev/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages: [ { role: "user", content: texto } ] })
  })
  .then(res => res.json())
  .then(data => {
    const respuesta = data.reply || "No entendí bien. ¿Podés explicarlo un poco más?";
    introPush('ia', respuesta);
  })
  .catch(() => {
    introPush('ia', "⚠️ Hubo un error al conectarse con la IA.");
  });
}

function detectarRedireccion(texto){
  const lower = texto.toLowerCase();

  if (/psicólogo|psicologa|terapia|profesional|quiero hablar con un profesional/.test(lower)) {
    introPush('ia', 'Perfecto, te llevo con un profesional.');
    hablar('Perfecto, te llevo con un profesional.');
    setTimeout(() => location.href = 'psicologo.html', 1500);
    return true;
  }

  if (/relajación|relajarme|ansiedad|estresado|respirar|calmarme|estres/.test(lower)) {
    introPush('ia', 'Te llevo a la sección de relajación.');
    hablar('Te llevo a la sección de relajación.');
    setTimeout(() => location.href = 'relajacion.html', 1500);
    return true;
  }

  if (/ayuda urgente|emergencia|no doy más|necesito ayuda urgente/.test(lower)) {
    introPush('ia', 'Redirigiéndote a ayuda inmediata.');
    hablar('Redirigiéndote a ayuda inmediata.');
    setTimeout(() => location.href = 'ayuda.html', 1500);
    return true;
  }

  if (/ia|chat|conversar|inteligencia artificial|quiero hablar con la ia|synaptica/.test(lower)) {
    introPush('ia', 'Te llevo al chat con nuestra IA especializada.');
    hablar('Te llevo al chat con nuestra IA especializada.');
    setTimeout(() => location.href = 'chat.html', 1500);
    return true;
  }

  if (/necesito ayuda|necesito hablar con alguien|me siento mal|estoy solo|nadie me quiere|quiero hablar con alguien/.test(lower)) {
    introPush('ia', 'Te llevo al chat para que puedas conversar mejor.');
    hablar('Te llevo al chat para que puedas conversar mejor.');
    setTimeout(() => location.href = 'chat.html', 1500);
    return true;
  }

  return false;
}

function hablar(texto){
  if (!vozActiva) return;
  const utterance = new SpeechSynthesisUtterance(texto);
  utterance.lang = 'es-AR';
  speechSynthesis.speak(utterance);
}

function toggleVoz(){
  vozActiva = !vozActiva;
  document.getElementById('vozToggle').textContent = vozActiva ? '🔊 Voz ON' : '🔇 Voz OFF';
  if (!vozActiva) speechSynthesis.cancel();
}

// RECONOCIMIENTO DE VOZ
if ('webkitSpeechRecognition' in window){
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'es-AR';
  recognition.continuous = false;
  recognition.interimResults = false;

  const micBtn = document.getElementById('mic-btn');
  micBtn.onclick = () => {
    recognition.start();
    micBtn.textContent = '🎙️ Escuchando...';
  };

  recognition.onresult = (e) => {
    const texto = e.results[0][0].transcript.trim();
    input.value = texto;
    micBtn.textContent = '🎤';
    introSend();
  };

  recognition.onerror = () => {
    micBtn.textContent = '🎤';
    alert('Error al capturar la voz. Intentá de nuevo.');
  };

  recognition.onend = () => {
    micBtn.textContent = '🎤';
  };
}
</script>

</body>
</html>
